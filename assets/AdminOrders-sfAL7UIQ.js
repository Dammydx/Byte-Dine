import{c as o,r as n,j as e,m as b,b as w,f as y,C as f,q as P,V as p,s as j,B as k,k as O}from"./index-o665ZfVT.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v=o("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N=o("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=o("ChefHat",[["path",{d:"M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 1.05-1.54 5 5 0 0 1 7.08 0A5.11 5.11 0 0 1 16.59 6 4 4 0 0 1 18 13.87V21H6Z",key:"z3ra2g"}],["line",{x1:"6",x2:"18",y1:"17",y2:"17",key:"12q60k"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=o("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=o("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),M=({order:s,onStatusUpdate:h})=>{var i;const[t,c]=n.useState(!1),[x,m]=n.useState(!1),l={Pending:"bg-yellow-50 text-yellow-700 border-yellow-200 dark:bg-yellow-900/30 dark:text-yellow-300 dark:border-yellow-700",Preparing:"bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/30 dark:text-blue-300 dark:border-blue-700",Completed:"bg-green-50 text-green-700 border-green-200 dark:bg-green-900/30 dark:text-green-300 dark:border-green-700",Cancelled:"bg-red-50 text-red-700 border-red-200 dark:bg-red-900/30 dark:text-red-300 dark:border-red-700"},u={Pending:e.jsx(f,{size:16}),Preparing:e.jsx(C,{size:16}),Completed:e.jsx(N,{size:16}),Cancelled:e.jsx(v,{size:16})},d=async r=>{if(r!==s.status)try{c(!0),await P(s.id,r),p.success(`Order status updated to ${r}`),h()}catch(a){console.error("Failed to update order status:",a),p.error("Failed to update order status")}finally{c(!1)}};return e.jsxs(b.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:`card mb-4 overflow-hidden border-l-4 ${s.status&&l[s.status]}`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between cursor-pointer",onClick:()=>m(!x),children:[e.jsxs("div",{className:"mb-2 sm:mb-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-heading text-lg font-semibold",children:["Table ",s.table_number]}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["â€¢ ",s.customer_name]})]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:w(s.created_at)})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:`badge flex items-center gap-1 ${l[s.status]}`,children:[u[s.status],s.status]}),e.jsx("div",{className:"font-bold text-primary-500",children:y(s.total_amount)})]})]}),x&&e.jsxs(b.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},children:[e.jsx("hr",{className:"my-3 border-gray-200 dark:border-gray-700"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Order Items:"}),e.jsx("div",{className:"space-y-2",children:(i=s.order_items)==null?void 0:i.map(r=>{var a;return e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"font-medium",children:[r.quantity,"x"]}),e.jsx("span",{children:(a=r.menu_items)==null?void 0:a.name})]}),e.jsx("span",{className:"font-medium",children:y(r.price*r.quantity)})]},r.id)})})]}),e.jsx("hr",{className:"my-3 border-gray-200 dark:border-gray-700"}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-end",children:[s.status!=="Pending"&&e.jsxs("button",{onClick:()=>d("Pending"),disabled:t||s.status==="Pending",className:`btn-secondary text-sm py-1 px-3 flex items-center gap-1 ${t?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(f,{size:16}),"Mark as Pending"]}),s.status!=="Preparing"&&e.jsxs("button",{onClick:()=>d("Preparing"),disabled:t||s.status==="Preparing",className:`bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 text-sm py-1 px-3 rounded-lg flex items-center gap-1 ${t?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(C,{size:16}),"Mark as Preparing"]}),s.status!=="Completed"&&e.jsxs("button",{onClick:()=>d("Completed"),disabled:t||s.status==="Completed",className:`bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300 text-sm py-1 px-3 rounded-lg flex items-center gap-1 ${t?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(N,{size:16}),"Mark as Completed"]}),s.status!=="Cancelled"&&e.jsxs("button",{onClick:()=>d("Cancelled"),disabled:t||s.status==="Cancelled",className:`bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300 text-sm py-1 px-3 rounded-lg flex items-center gap-1 ${t?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(v,{size:16}),"Mark as Cancelled"]})]})]})]})},S=new Audio("/notification.mp3"),A=()=>{const[s,h]=n.useState([]),[t,c]=n.useState([]),[x,m]=n.useState(!0),[l,u]=n.useState("all"),d=n.useRef(0),i=async()=>{try{m(!0);const a=await O();d.current>0&&a.length>d.current&&(S.play().catch(g=>{console.error("Failed to play notification sound:",g)}),p.success("New order received!")),d.current=a.length,h(a)}catch(a){console.error("Failed to load orders:",a),p.error("Failed to load orders")}finally{m(!1)}};n.useEffect(()=>{i();const a=j.channel("orders-channel").on("postgres_changes",{event:"*",schema:"public",table:"orders"},g=>{i()}).subscribe();return()=>{j.removeChannel(a)}},[]),n.useEffect(()=>{c(l==="all"?s:s.filter(a=>a.status===l))},[l,s]);const r=()=>{i()};return x&&s.length===0?e.jsxs("div",{className:"animate-pulse",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 w-1/4 rounded"}),e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 w-1/6 rounded"})]}),[...Array(3)].map((a,g)=>e.jsxs("div",{className:"card mb-4 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-1/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/3 mb-2"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-1/6"}),e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-1/6"})]})]},g))]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 mb-6",children:[e.jsx("h1",{className:"text-2xl font-heading font-bold",children:"Orders"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:l,onChange:a=>u(a.target.value),className:"input",children:[e.jsx("option",{value:"all",children:"All Orders"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Preparing",children:"Preparing"}),e.jsx("option",{value:"Completed",children:"Completed"}),e.jsx("option",{value:"Cancelled",children:"Cancelled"})]}),e.jsx(k,{variant:"secondary",leftIcon:e.jsx(F,{size:18}),onClick:r,className:"flex-shrink-0",children:"Refresh"})]})]}),t.length===0?e.jsxs(b.div,{initial:{opacity:0},animate:{opacity:1},className:"card p-6 text-center",children:[e.jsxs("div",{className:"text-gray-500 dark:text-gray-400 mb-4",children:[e.jsx(z,{className:"mx-auto mb-2",size:32}),e.jsxs("p",{children:["No ",l!=="all"?l.toLowerCase():""," orders found"]})]}),l!=="all"&&e.jsx(k,{variant:"secondary",onClick:()=>u("all"),children:"View All Orders"})]}):e.jsx("div",{children:t.map(a=>e.jsx(M,{order:a,onStatusUpdate:i},a.id))})]})};export{A as default};
